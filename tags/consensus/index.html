<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-updates">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">8 posts tagged with &quot;consensus&quot; | Cardano Development Updates</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://input-output-hk.github.io/cardano-updates/tags/consensus"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="8 posts tagged with &quot;consensus&quot; | Cardano Development Updates"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/cardano-updates/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://input-output-hk.github.io/cardano-updates/tags/consensus"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/cardano-updates/tags/consensus" hreflang="en"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/cardano-updates/tags/consensus" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/cardano-updates/rss.xml" title="Cardano Updates Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cardano-updates/atom.xml" title="Cardano Updates Feed Atom Feed">
<link rel="alternate" type="application/json" href="/cardano-updates/feed.json" title="Cardano Updates Feed JSON Feed">



<link rel="alternate" type="application/rss+xml" href="/cardano-updates/quarterly/rss.xml" title="Cardano Development Updates RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cardano-updates/quarterly/atom.xml" title="Cardano Development Updates Atom Feed">
<script src="https://plausible.io/js/script.js" defer="defer" data-domain="input-output-hk.github.io/cardano-updates"></script><link rel="stylesheet" href="/cardano-updates/assets/css/styles.1b2b551c.css">
<link rel="preload" href="/cardano-updates/assets/js/runtime~main.06a7ec9a.js" as="script">
<link rel="preload" href="/cardano-updates/assets/js/main.10c1ba15.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cardano-updates/"><div class="navbar__logo"><img src="/cardano-updates/img/logo.svg" alt="Cardano Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cardano-updates/img/logo.svg" alt="Cardano Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cardano Updates</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cardano-updates/">Home</a><a class="navbar__item navbar__link" href="/cardano-updates/quarterly">Quarterly</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/cardano-updates/tags">Topics</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cardano-updates/tags">All Topics</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/network">Network</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cardano-updates/tags/consensus">Consensus</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/ledger">Ledger</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/hydra">Hydra</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/db-sync">DB Sync</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/cli-api">Node CLI &amp; API</a></li><li><a class="dropdown__link" href="/cardano-updates/quarterly/tags/cli-api-quarterly">Node CLI &amp; API Quarterly</a></li><li><a class="dropdown__link" href="/cardano-updates/tags/crypto">Crypto</a></li></ul></div><a class="navbar__item navbar__link" href="/cardano-updates/archive">Archive</a><a href="https://github.com/input-output-hk/cardano-updates" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2023-01-06-crypto">Crypto Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2023-01-05-ledger">Ledger Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-16-hydra">Hydra Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-15-mithril">Mithril Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-14-consensus">Consensus Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-14-db-sync">DB-sync Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-14-performance-and-tracing">Performance &amp; tracing update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-12-network">Network Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-09-crypto">Crypto Team Update</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cardano-updates/2022-12-09-hydra">Hydra Team Update</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>8 posts tagged with &quot;consensus&quot;</h1><a href="/cardano-updates/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cardano-updates/2022-12-14-consensus">Consensus Team Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-14T00:00:00.000Z" itemprop="datePublished">December 14, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dnadales.png" alt="Damian Nadales"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Damian Nadales</span></a></div><small class="avatar__subtitle" itemprop="description">Consensus Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">​</a></h2><p>During the past two weeks, the Consensus team finalized the QSM tests for the
backing store and Mempool on the UTxO-HD branch with important discoveries
regarding parallel QSM testing. We also worked with the Ledger team to envisage
the modifications that are required in Ledger and Consensus to accommodate the
changes in the crypto VRF and KES. The <code>db-analyser</code> now supports bechmarking
the ledger operations, which will allow us to identify, debug, and profile
potential performance problems. We drafted a document that defines how to manage
the versions of Consensus-related packages. The top level documentation of
<code>ouroboros-network</code> now features a description of the consensus components and
provides a hyperlinked map to the modules documentation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workstreams">Workstreams<a class="hash-link" href="#workstreams" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="utxo-hd-prototype">UTxO HD prototype<a class="hash-link" href="#utxo-hd-prototype" title="Direct link to heading">​</a></h3><p>Whereas we had passing sequential state-machine tests for the mempool, the
parallel case proved to be more challenging than we thought. The operation of
adding a list of transactions to the mempool is not atomic and, as a result,
when adding a list of transactions, transactions from other processes can be
added in between. The mempool implementation handles this correctly, however
this required us to <a href="https://github.com/input-output-hk/ouroboros-network/pull/4076" target="_blank" rel="noopener noreferrer">redesign</a> the parallel model we had to take
the lack of atomicity into account.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backing-store-property-tests">Backing store property tests<a class="hash-link" href="#backing-store-property-tests" title="Direct link to heading">​</a></h4><p>We finished refactoring the backing store property tests. The second review
round is ongoing.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lsm-tree-implementation">LSM tree implementation<a class="hash-link" href="#lsm-tree-implementation" title="Direct link to heading">​</a></h3><p>We are working on benchmarking (in terms of time and number of IO operations)
fetching/looking up data from disk.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="genesis">Genesis<a class="hash-link" href="#genesis" title="Direct link to heading">​</a></h3><p>We worked on the design of a mechanism to prevent a DoS attack on our Genesis
design related to rollbacks. This was arguably the biggest outstanding question.</p><p>During the discussions around Genesis, we noticed a design boundary that nicely
delineates a fundamental component. We almost have a full Haskell prototype of
it. It will be very nicely self-contained, perhaps even usable in the ultimate
implementation!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-vrf-and-kes-crypto-integration">New VRF and KES crypto integration<a class="hash-link" href="#new-vrf-and-kes-crypto-integration" title="Direct link to heading">​</a></h3><p>We collaborated with the Ledger team on preparing the ledger state and crypto
types to avoid huge allocation on the epoch boundary when changing aspects of
the crypto that will only manifest in headers, not in the ledger states.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="technical-debt">Technical debt<a class="hash-link" href="#technical-debt" title="Direct link to heading">​</a></h3><p>We merged the <a href="https://github.com/input-output-hk/ouroboros-network/pull/4014" target="_blank" rel="noopener noreferrer">pull-request</a> that adds a support to <code>db-analyser</code> for
benchmarking ledger operations. This will allow us to identify, debug, and
profile potential performance problems. The benchmark focus on the main 5 ledger
operations that are involved in chain syncing, block forging, and block
validation, namely:</p><ol start="0"><li>Forecast.</li><li>Header tick.</li><li>Header application.</li><li>Block tick.</li><li>Block application.</li></ol><p>The following figure shows a plot of the benchmarking results for the first 65
million blocks (approximately) of the Cardano chain. The thin yellow lines under
the x-axis show the epoch boundaries, whereas the thick yellow lines correspond
to the era transitions.</p><p><img loading="lazy" src="/cardano-updates/assets/images/2022-12-14-ledger-ops-benchmark-c46be3db45ff5480ed104e0d520711a6.png" width="1600" height="800" class="img_ev3q"></p><p>As we can see in this figure, era and epoch boundaries require more computation
time. The ledger team are aware of this problem, and we are working to improve
this situation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fostering-collaboration">Fostering collaboration<a class="hash-link" href="#fostering-collaboration" title="Direct link to heading">​</a></h3><p>We <a href="https://github.com/input-output-hk/ouroboros-network/pull/4207" target="_blank" rel="noopener noreferrer">drafted a document</a> motivating and defining how Consensus (and
possibly other core teams) will/should manage our package versions. This
pull-request garnered many great discussions from our team members and other
teams too: Sebastian Nagel, Arnaud Bailly, Michael Peyton-Jones, Ziyang Liu, et
al. We want to thank you all for your input, and we found this discussion very
enlightening!</p><p>We merged the <a href="https://github.com/input-output-hk/ouroboros-network/pull/4197" target="_blank" rel="noopener noreferrer">pull request</a> that adds an overview of consensus to
the <a href="https://input-output-hk.github.io/ouroboros-network/" target="_blank" rel="noopener noreferrer">top level
documentation</a> of
ouroboros-network. This overview describes the consensus components and adds a
hyperlinked map to the modules documentation.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cardano-updates/tags/consensus">consensus</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cardano-updates/2022-11-30-consensus">Consensus Team Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-30T00:00:00.000Z" itemprop="datePublished">November 30, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dnadales.png" alt="Damian Nadales"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Damian Nadales</span></a></div><small class="avatar__subtitle" itemprop="description">Consensus Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">​</a></h2><p>During the past two weeks, the consensus team merged improvements to the monadic
cursor API that was needed to implement LMDB range reads, which is in turn
required for the implementation of the UTxO HD feature. We added tables to
several tests in for the UTxO HD feature, which increases our confidence in the
correctness of the prototype. The mempool property tests are close to being
completed. Also, we finished the LSM tree tuning algorithm.</p><p>On the Genesis front we started simplifying the BlockFetch logic with
CSJ-specific workloads in mind. </p><p>We are also documenting the Block Diffusion Pipelining feature, and added a
high-level overview of consensus to the top level documentation of
<code>ouroboros-network</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workstreams">Workstreams<a class="hash-link" href="#workstreams" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="utxo-hd-prototype">UTxO HD prototype<a class="hash-link" href="#utxo-hd-prototype" title="Direct link to heading">​</a></h3><p>We merged the implementation of a monadic cursor API (<a href="https://github.com/input-output-hk/lmdb-simple/pull/1" target="_blank" rel="noopener noreferrer">#1</a>)) which was
needed to solve a bug with LMDB range-reads. After this PR was merged, we focused on
bridging the gap between the <code>lmdb-simple</code> interface and consensus by facilitating
using <code>lmdb-simple</code>&#x27;s cursor API without <code>Serialise</code> constraints (<a href="https://github.com/input-output-hk/lmdb-simple/pull/3" target="_blank" rel="noopener noreferrer">#3</a>).</p><p>We refactored the backing store property tests to use <code>quickcheck-lockstep</code>
(<a href="https://github.com/input-output-hk/ouroboros-network/pull/4081" target="_blank" rel="noopener noreferrer">#4081</a>).</p><p>We added tables to the mock ledger in the UTxO-HD feature branch
(<a href="https://github.com/input-output-hk/ouroboros-network/pull/4184" target="_blank" rel="noopener noreferrer">#4184</a>). Every test that used to run with <code>SimpleBlocks</code> now uses
tables. This will enable us to exercise the UTxO HD mempool integration by
leveraging the existing mempool property-tests. The new state-machine
property-tests are still needed for testing the parallel behaviour of the
mempool.</p><p>Our work on the mempool state-machine tests revealed the need for improvements
in the <code>quickcheck-state-machine</code> library. Parallel testing assumed that the
state machine did not have access to mutable references. However, the mempool
tests require the use of such mutable references for mocking the ledger
interface. As a result, our parallel tests were failing with rather obscure
messages. @Jasagredo submitted a pull request (<a href="https://github.com/stevana/quickcheck-state-machine/pull/12" target="_blank" rel="noopener noreferrer">#12</a>) that allows for
new mutable references to be created at each run of the state machine.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backing-store-property-tests">Backing store property tests<a class="hash-link" href="#backing-store-property-tests" title="Direct link to heading">​</a></h4><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lsm-tree-implementation">LSM tree implementation<a class="hash-link" href="#lsm-tree-implementation" title="Direct link to heading">​</a></h3><p>We finished the LSM Tree tuning algorithm. We are currently tidying up the code
and gathering results (i.e., plots and their interpretation).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="csj-prototype">CSJ prototype<a class="hash-link" href="#csj-prototype" title="Direct link to heading">​</a></h3><p>We started simplifying the BlockFetch logic with CSJ-specific workloads in mind.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-vrf-and-kes-crypto-integration">New VRF and KES crypto integration<a class="hash-link" href="#new-vrf-and-kes-crypto-integration" title="Direct link to heading">​</a></h3><p>Started working on supporting new version of <code>StandardCrypto</code> which uses compact
KES and batched VRF (<a href="https://github.com/input-output-hk/ouroboros-network/issues/4151" target="_blank" rel="noopener noreferrer">#4151</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="technical-debt">Technical debt<a class="hash-link" href="#technical-debt" title="Direct link to heading">​</a></h3><p>We reviewed the existing state of the Block Diffusion Pipelining document. We
are now working on the &quot;Implementation&quot; section (<a href="https://github.com/input-output-hk/ouroboros-network/issues/4020" target="_blank" rel="noopener noreferrer">#4020</a>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fostering-collaboration">Fostering collaboration<a class="hash-link" href="#fostering-collaboration" title="Direct link to heading">​</a></h3><p>We cleared up our understanding of the error dynamics of forecasting
(<a href="https://github.com/input-output-hk/ouroboros-network/pull/4146" target="_blank" rel="noopener noreferrer">#4146</a> and <a href="https://github.com/input-output-hk/ouroboros-network/pull/4174" target="_blank" rel="noopener noreferrer">#4174</a>).</p><p>We submitted a pull request that adds an overview of consensus to the <a href="https://input-output-hk.github.io/ouroboros-network/" target="_blank" rel="noopener noreferrer">top level
documentation</a> of
ouroboros-network (<a href="https://github.com/input-output-hk/ouroboros-network/pull/4197" target="_blank" rel="noopener noreferrer">#4197</a>). This overview describes the consensus components and adds a
hyperlinked map to the modules documentation.</p><p><a href="https://github.com/input-output-hk/ouroboros-network/pull/4197" target="_blank" rel="noopener noreferrer">https://github.com/input-output-hk/ouroboros-network/pull/4197</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cardano-updates/tags/consensus">consensus</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cardano-updates/2022-11-16-consensus">Consensus Team Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-16T00:00:00.000Z" itemprop="datePublished">November 16, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dnadales.png" alt="Damian Nadales"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Damian Nadales</span></a></div><small class="avatar__subtitle" itemprop="description">Consensus Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High-level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">​</a></h2><p>During the past two weeks, the consensus team started documenting the
implementation of the UTxO HD feature and continued developing tests for it. As
part of our work on UTxO HD, we improved the Haskell support for LMDB. We also
spent time working on the LSM tree prototype, and designed a parameter tuning
algorithm for it. Regarding our work on Genesis, our investigation of the
&quot;plateaus&quot; pointed at the <code>TICKF</code> slowdown on era boundaries as culprit. This
led us to developing a caching strategy that will not only remove the
aforementioned &quot;plateaus&quot;, but can help alleviating the growing block production
delay on epoch switch. We also helped reviewing the block forge credential
hotswap feature, which is intended for use in the adoption of P2P.</p><p>We also worked on paying technical debt and fostering collaboration. In
particular, we improved the <code>io-sim</code> framework, which is crucial for testing and
simulating Cardano components. We also removed thunks that appeared on era
translations, and improved our diffusion pipelining feature. We are working on a
presentation for explaining Praos and Genesis.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-status-report">High-level status report<a class="hash-link" href="#high-level-status-report" title="Direct link to heading">​</a></h2><ul><li>Finish the UTxO HD prototype: in progress.<ul><li>We added documentation for this feature.</li><li>We developed the second version of the mempool tests.</li><li>We fixed benchmarks that were inflating the speedup we observed in the
anti-diff implementation of sequences of differences. Speedups are now in the
range of <!-- -->[3.33, 4.75]<!-- -->, which remain significant.</li><li>We continued improving Haskell LMDB support.</li><li>We finished implementing a &quot;parameter tuning algorithm&quot; for the LSM tree
prototype. This enables us to run experiments to check the correctness of
the algorithm.</li></ul></li><li>Genesis: in progress.<ul><li>Work investigating the &quot;plateaus&quot; in the <code>ChainSync</code> jumping prototype
pointed to the <code>TICKF</code> slowdown on era boundaries as culprit.</li></ul></li><li>Tech debt:<ul><li>We improved the capabilities of our <code>io-sim</code> library, which is crucial for
testing and simulating Cardano components.</li><li>We removed thunks from epoch translations in the ledger.</li><li>We added Linux CI support for <code>lmdb-simple</code>.</li><li>We got pending diffusion pipelining improvements merged.</li></ul></li><li>Fostering collaboration:<ul><li>We are working on a explanation of Praos and Genesis protocols.</li></ul></li><li>Support:<ul><li>Investigation of CSJ &quot;plateaus&quot; led us to developing a caching strategy for
<code>TICKF</code> that will not only remove these &quot;plateaus&quot;, but can help alleviating
the growing block production delay on epoch switch.</li><li>We reviewed the block forge credential hotswapping feature which is intended
for use in the adoption of P2P.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workstreams">Workstreams<a class="hash-link" href="#workstreams" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finish-the-utxo-hd-prototype">Finish the UTxO HD prototype<a class="hash-link" href="#finish-the-utxo-hd-prototype" title="Direct link to heading">​</a></h3><p>We merged PR <a href="https://github.com/input-output-hk/ouroboros-network/pull/4060" target="_blank" rel="noopener noreferrer">#4060</a>, which adds a report documenting the UTxO HD
feature, and puts emphasis in explaining how the mempool works in combination
with UTxO HD.</p><p>We opened a draft PR with the second iteration of the property tests for the
mempool (<a href="https://github.com/input-output-hk/ouroboros-network/pull/4076" target="_blank" rel="noopener noreferrer">#4076</a>).</p><p>We fixed the <code>Arbitrary</code> instances for keys and values in <code>DiffSeq</code> benchmarks
(<a href="https://github.com/input-output-hk/ouroboros-network/pull/4143" target="_blank" rel="noopener noreferrer">#4143</a>). The problem was that we were testing with mostly small
values, which artificially boosted the performance gains we saw on benhcmarks.
Speedups are now in the range of <!-- -->[3.33, 4.75]<!-- --> across the different
configurations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backing-store-property-tests">Backing store property tests<a class="hash-link" href="#backing-store-property-tests" title="Direct link to heading">​</a></h4><p>We focused on incorporating feedback on the monadic cursor API PR (<a href="https://github.com/input-output-hk/lmdb-simple/pull/1" target="_blank" rel="noopener noreferrer">#1</a>).
This required us to make small tweaks to <code>quickcheck-lockstep</code> to test the new
API. We also updated the backing store property tests to use the new version of
the monadic cursor API.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lsm-tree-implementation">LSM tree implementation<a class="hash-link" href="#lsm-tree-implementation" title="Direct link to heading">​</a></h3><p>We worked on the LSM tree prototype. In particular: finished implementing a
&quot;parameter tuning algorithm&quot; that adapts the LSM tree design based on factors
like:</p><ul><li>workload</li><li>machine specs, </li><li>and characteristics of the data being stored. </li></ul><p>We are now running experiments to gather results and cross-reference them with
existing experimental results from the LSM tree paper to see if the algorithm is
working correctly.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-the-csj-prototype">Benchmarking the CSJ prototype<a class="hash-link" href="#benchmarking-the-csj-prototype" title="Direct link to heading">​</a></h3><p>We focused on investigating the &quot;plateaus&quot; in the <code>ChainSync</code> tip, which turned
out to be due to the <code>TICKF</code> bug which we previously were only aware of in the
context of the long forging times near epoch boundaries. For the most drastic
patch by @nfrisby to speed up <code>TICKF</code>, full sync is speeding up by 7%.</p><p>The following plot shows that by caching the <code>TICKF</code> the <code>ChainSync</code> tip and the
<code>VolatileDB</code> tip progress at the same rate.</p><p><img loading="lazy" src="/cardano-updates/assets/images/2022-11-16-removed-stuttering-e49aa27a0e549f0195373203da971ba7.png" width="765" height="445" class="img_ev3q"></p><p>The plot below shows the speedup observed by caching the <code>TICKF</code> rule wrt the
baseline.</p><p><img loading="lazy" src="/cardano-updates/assets/images/2022-11-16-comparing-TICKF-batch-c6570a71c4a5d53b10cb7309d2cc742c.png" width="773" height="445" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="technical-debt">Technical debt<a class="hash-link" href="#technical-debt" title="Direct link to heading">​</a></h3><p>After addressing the PR comments, we merged PR <a href="https://github.com/input-output-hk/io-sim/pull/16" target="_blank" rel="noopener noreferrer">#16</a>, which implements
the <code>MonadCatch</code> instance for <code>STM</code>. This extends the capability of our <code>io-sim</code>
library, which is crucial for testing and simulating Cardano components PR #16
closed <a href="https://github.com/input-output-hk/ouroboros-network/issues/1461" target="_blank" rel="noopener noreferrer">#1461</a>. This new feature was published as version <code>0.4.0.0</code>
of <code>io-sim</code>.</p><p>We continued with our work fixing the <code>NoThunk</code> errors required for enabling
nightly tests, with the help of <code>TVarInvariant</code> checks in <code>strict-stm</code> and
<code>nothunks</code> libraries. We proposed fixes in <code>cardano-ledger</code> that took care of
thunks that appeared in era translations (<a href="https://github.com/input-output-hk/cardano-ledger/pull/3143" target="_blank" rel="noopener noreferrer">#3143</a>). The fixes will be
integrated back into consensus when <code>cardano-ledger</code> approves and publish the
changes introduced in <code>#3143</code>.</p><p>We added CI support for <code>lmdb-simple</code> (<a href="https://github.com/input-output-hk/lmdb-simple/pull/2" target="_blank" rel="noopener noreferrer">#2</a>). We currently test the build on
a Linux environment only.</p><p>We got pending diffusion pipelining PRs (<a href="https://github.com/input-output-hk/ouroboros-network/pull/3857" target="_blank" rel="noopener noreferrer">#3857</a>, <a href="https://github.com/input-output-hk/ouroboros-network/pull/3860" target="_blank" rel="noopener noreferrer">#3860</a>,
<a href="https://github.com/input-output-hk/ouroboros-network/pull/3856" target="_blank" rel="noopener noreferrer">#3856</a>) merged, after rebasing and addressing feedback.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fostering-collaboration">Fostering collaboration<a class="hash-link" href="#fostering-collaboration" title="Direct link to heading">​</a></h3><p>@nfrisby finished a visualisation tool and outlined scripts for the Praos and
Genesis explanation presentations. The idea is to produce a video that gives an
overview of these protocols.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="support">Support<a class="hash-link" href="#support" title="Direct link to heading">​</a></h3><p>We started working on caching the computation of the <code>TICKF</code> rule
(<a href="https://github.com/input-output-hk/ouroboros-network/issues/4054" target="_blank" rel="noopener noreferrer">#4054</a>), since this was blocking our benchmarking work for
Genesis. In addition, this issue has the Cardano community <a href="https://github.com/input-output-hk/cardano-node/issues/4421" target="_blank" rel="noopener noreferrer">quite
concerned</a>, so we are hoping the work done in caching the
computation of the <code>TICKF</code> rule can help alleviating the growing block
production delay on epoch switch.</p><p>We reviewed the block forge credential hotswapping PR <a href="https://github.com/input-output-hk/ouroboros-network/pull/3800" target="_blank" rel="noopener noreferrer">#3800</a> from the
networking team, which is intended for use in the adoption of P2P.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cardano-updates/tags/consensus">consensus</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cardano-updates/2022-10-02-consensus">Consensus Team Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-02T00:00:00.000Z" itemprop="datePublished">November 2, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dnadales.png" alt="Damian Nadales"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Damian Nadales</span></a></div><small class="avatar__subtitle" itemprop="description">Consensus Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High-level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">​</a></h2><p>During the past two weeks, the consensus team continued its work on testing the
UTxO HD prototype. We completed the era-transition and backing store tests, and
the mempool tests are advancing at a steady pace. Regarding our work in the
Genesis design, we continued our collaboration with the research and networking
teams, and we continue investigating strategies for making the chain-sync
jumping prototype faster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-status-report">High-level status report<a class="hash-link" href="#high-level-status-report" title="Direct link to heading">​</a></h2><ul><li>Finish the UTxO HD prototype: on track.<ul><li>We worked on state-machine tests for the mempool, and spotted potential bugs
in the implementation. Investigation is ongoing.</li><li>We have a set of property tests for the backing store. We still need to
incorporate the improvements to the LMDB cursor API that these tests
made possible.</li><li>We merged the era-transition tests PR.</li></ul></li><li>Genesis: on track.<ul><li>Design work around Genesis continues in collaboration with researchers and
the networking team.</li><li>We continued trying to improve the performance of the chain-sync jumping
prototype. We gained additional insight on which parameters to tweak next.
In spite of the baseline still being faster, the current prototype already
achieves a significant speedup when compared to the naive approach of simply
running full chain-sync with all peers.</li></ul></li><li>Tech debt: on track.<ul><li>We clarified a common source of confusion around VRF tie-breaking and
cross-era chain selection.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workstreams">Workstreams<a class="hash-link" href="#workstreams" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finish-the-utxo-hd-prototype">Finish the UTxO HD prototype<a class="hash-link" href="#finish-the-utxo-hd-prototype" title="Direct link to heading">​</a></h3><p>We continued working on property-tests for the UTxO HD prototype. In particular
we merged the <a href="https://github.com/input-output-hk/ouroboros-network/pull/4073" target="_blank" rel="noopener noreferrer">era-transition tests
PR</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backing-store-property-tests">Backing store property tests<a class="hash-link" href="#backing-store-property-tests" title="Direct link to heading">​</a></h4><p>The <a href="https://github.com/input-output-hk/ouroboros-network/pull/4081" target="_blank" rel="noopener noreferrer">backing store property tests
PR</a> has been
reviewed. The next steps are:</p><ul><li>Improve error handling and command generation.</li><li>Add coverage testing to check that we are not failing to cover interesting
test cases.</li></ul><p>The <a href="https://github.com/input-output-hk/lmdb-simple/pull/1" target="_blank" rel="noopener noreferrer">monadic cursor API</a>
went through its first review round. The API is in a relatively stable state.
This PR also unifies the <code>cborg</code> and <code>serialise</code>-based interfaces to LMDB
operations. The next steps are:</p><ul><li>Write
<a href="https://hackage.haskell.org/package/quickcheck-dynamic" target="_blank" rel="noopener noreferrer"><code>quickcheck-dynamic</code></a>
state-machine tests for this API.</li><li>Adapt the changes in the serialisation interface in the backing store property
tests. This will involve adding boilerplate code in consensus to make up for
the removal of the <code>cborg</code>-based interface.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lsm-tree-implementation">LSM tree implementation<a class="hash-link" href="#lsm-tree-implementation" title="Direct link to heading">​</a></h2><p>We worked on the <a href="https://github.com/input-output-hk/ouroboros-network/issues/4121" target="_blank" rel="noopener noreferrer">LSM tree
prototype</a>. In
particular, we focused on tuning the LSM tree design to the different workloads
that consensus has (eg syncing, normal node operation, etc).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-the-csj-prototype">Benchmarking the CSJ prototype<a class="hash-link" href="#benchmarking-the-csj-prototype" title="Direct link to heading">​</a></h3><p>Work on improving the chain-sync jumping performance is ongoing. In particular
we compared the performance of different jump intervals, which, somewhat
surprisingly, do not make a significant difference. In particular, we are seeing
periodic &quot;plateaus&quot; where the chain-sync tip does not progress, but they are
much longer for the prototype. Our hypothesis is that this seem to be due to a
combination of the garbage collector (GC) pauses, and the actual time it takes
the non-dynamo chain-sync peers to jump to the tip of the slot of the dynamo
fragment.</p><p>In the coming weeks we will try to shorten these plateaus via a combination of
tweaking GC options and less synchronisation in the CSJ governor.</p><p>The following plot shows the performance of the chain-sync jumping prototype
using different jumping intervals. It compares the syncing progress by plotting
the slots of adopted blocks against time. The baseline is still faster, however
it is worth noting that the current prototype already achieves a significant
speedup when compared to the naive approach of simply running full chain-sync
with all peers.</p><p><img loading="lazy" src="/cardano-updates/assets/images/2022-11-02-csj-vs-baseline-9fd0e0e080975cc6cfbe035731b4f38d.svg" width="998" height="445" class="img_ev3q"></p><p>The second plot shows the syncing progress sliced to a chosen ~5min interval,
and includes, in addition to the slots of adopted blocks, the slots of the tip
of the ChainSync fragment. This allows us to see how far ahead of the selected
tip the CS dynamo is, i.e. how much room we have for BlockFetch not to get
stalled. It shows periodic behaviour (due to the forecasting limit), and shows
that the CS fragment tip is not progressing for significant periods
(&quot;plateaus&quot;).</p><p><img loading="lazy" src="/cardano-updates/assets/images/2022-11-02-csj-vs-baseline-sliced-77ff018af70191b4122b1e7cf56c79b8.svg" width="998" height="445" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="technical-debt">Technical debt<a class="hash-link" href="#technical-debt" title="Direct link to heading">​</a></h2><p>We <a href="https://github.com/input-output-hk/ouroboros-network/pull/4098" target="_blank" rel="noopener noreferrer">clarified</a> a
common source of confusion around VRF tie-breaking and cross-era chain
selection. This PR involved correcting potentially misleading names of
VRF-related functions, and providing context for a particular VRF value is
used for tie-breaking.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cardano-updates/tags/consensus">consensus</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cardano-updates/2022-10-18-consensus">Consensus Team Update</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-10-18T00:00:00.000Z" itemprop="datePublished">October 18, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dnadales.png" alt="Damian Nadales"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dnadales" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Damian Nadales</span></a></div><small class="avatar__subtitle" itemprop="description">Consensus Team Lead</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-summary">High-level summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">​</a></h2><p>During the past two weeks, the consensus team worked on adding property test for
different aspects of the UTxO HD prototype: era transitions, mempool, and
backing store. Thanks to these tests we were able to uncover a bug in the
prototype. On the Genesis front, we benchmarked a different version of the
ChainSync jumping prototype to try to improve its performance, but this did not
result in any noticeable speedup.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-status-report">High-level status report<a class="hash-link" href="#high-level-status-report" title="Direct link to heading">​</a></h2><ul><li>Finish the UTxO HD prototype: on track.<ul><li>We focused on increasing test coverage for the UTxO-HD prototype:<ul><li>We started implementing Cadano-eras transition property-tests.</li><li>We started implementing state-machine property-tests for the mempool.</li><li>We merged the mempool rewrite.</li><li>We started working on state-machine tests for the backing store. This
uncovered a bug in the range-read implementation of the LMDB backing
store.</li></ul></li></ul></li><li>Genesis: on track.<ul><li>We benchmarked a version of the Genesis ChainSync Jumping prototype that
spreads out the ChainSync updates over a longer period of time. This did not
result in any noticeable speedup.</li><li>We investigated the overhead introduced by non-ChainSync components, but no
conclusions could be drawn from the benchmarks we ran.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workstreams">Workstreams<a class="hash-link" href="#workstreams" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finish-the-utxo-hd-prototype">Finish the UTxO HD prototype<a class="hash-link" href="#finish-the-utxo-hd-prototype" title="Direct link to heading">​</a></h3><p>We focused on increasing test coverage for the UTxO HD prototype. We also merged
the <a href="https://github.com/input-output-hk/ouroboros-network/pull/4049" target="_blank" rel="noopener noreferrer">mempool
rewrite</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="era-transition-property-tests">Era transition property tests<a class="hash-link" href="#era-transition-property-tests" title="Direct link to heading">​</a></h4><p>We started implementing <a href="https://github.com/input-output-hk/ouroboros-network/issues/4043" target="_blank" rel="noopener noreferrer">Cardano era transition property
tests</a>,
which are needed for making sure that the ledger tables get updated in the
right way when we move from one era to the next. There are at the moment two
important transitions.</p><ul><li>Byron to Shelley: where all the UTxO is transferred from in-memory Byron
state (which has no tables) to the ledger tables of the Shelley state.</li><li>Shelley to Allegra: where the AVVM addresses must be deleted.</li></ul><p>We have tests for the Byron to Shelley transitions. We are working on adding
the remaining ones.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mempool-state-machine-tests">Mempool state-machine tests<a class="hash-link" href="#mempool-state-machine-tests" title="Direct link to heading">​</a></h4><p>We started implementing <a href="https://github.com/input-output-hk/ouroboros-network/issues/4044" target="_blank" rel="noopener noreferrer">state-machine property tests for the
mempool</a>.
The mempool is currently tested via pure property tests, and use a ledger
state without tables. With the introduction of UTxO HD, testing the concurrent
behavior of the mempool became of crucial importance (eg now we have to
acquire locks to flush the backing store). In addition, we need to test a
ledger state with tables. These needs led to the creation of a new set of
property tests. In particular we aim to run parallel state-machine tests that
exercise the mempool in a way similar to how the node would make use of it.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="backing-store-property-tests">Backing store property tests<a class="hash-link" href="#backing-store-property-tests" title="Direct link to heading">​</a></h4><p>We started working on <a href="https://github.com/input-output-hk/ouroboros-network/pull/4081" target="_blank" rel="noopener noreferrer">state-machine tests for the backing
store</a> that UTxO
HD uses. The property tests uncovered errors in the range-reads implementation
of the LMDB backing store. To facilitate fixing this bug, we made
<a href="https://github.com/input-output-hk/lmdb-simple/pull/1" target="_blank" rel="noopener noreferrer">changes</a> to the Haskell
LMDB bindings.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-the-csj-prototype">Benchmarking the CSJ prototype<a class="hash-link" href="#benchmarking-the-csj-prototype" title="Direct link to heading">​</a></h3><p>Prompted by previous benchmarks showing significant improvements in sync time by
using more capabilities, we implemented a way to spread out the ChainSync
updates over a larger period instead of firing them all at the same time. This
didn&#x27;t result in a noticeable speedup.</p><p>We also benchmarked the prototype with CSJ disabled (such that just the dynamo
peer is running ChainSync, but e.g. BlockFetch still sees all peers) to rule
out/confirm overhead by non-ChainSync (mainly BlockFetch) related components.
This results in era-specific behavior (speed is like the prototype in Byron, but
like the baseline in Shelley). This deserves a closer look in the future.</p><p>This diagram shows the respective syncing progress, starting at Genesis and
continuing a good part into Shelley (with the dashed line indicating the
Byron-to-Shelley transition).</p><ul><li>Red: baseline</li><li>Green: CSJ prototype, 10 peers, jumps every 3000/f slots, jumps in clumps.</li><li>Blue: like Green, jumps are spread out.</li><li>Orange: variant with no jumping, to measure unrelated overhead.</li></ul><p><img loading="lazy" src="/cardano-updates/assets/images/happy-path-csj-prototype-bench-2-e23d2986ddef0a187df9ce336b2db116.svg" width="654" height="459" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cardano-updates/tags/consensus">consensus</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/cardano-updates/tags/consensus/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cardano-updates/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/cardano-updates/archive">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/cardano-updates/tags">Tags</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Input Output Global, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cardano-updates/assets/js/runtime~main.06a7ec9a.js"></script>
<script src="/cardano-updates/assets/js/main.10c1ba15.js"></script>
</body>
</html>